"use strict";var howLongApp=angular.module("howLongApp",["howLongControllers","howLongFilters","angularMoment"]),howLongControllers=angular.module("howLongControllers",[]);howLongControllers.controller("SampleListCtrl",["$scope","$filter",function(e,t){function a(e){return!isNaN(parseFloat(e))&&isFinite(e)}function n(e){var t=e.split(":"),n=new Date;return n.setHours(a(t[0])?t[0]:0),n.setMinutes(a(t[1])?t[1]:0),n.setSeconds(a(t[2])?t[2]:0),n}function l(e,t){var a=t.value-e.value,n=t.time-e.time;return Math.abs(a/n)}function s(e,t,a,n,l){var s=(n-a)/(t-e);return a+s*(l-e)}function i(){if(e.samples.length<2)return e.rate=null,e.remaining=null,void(e.estimate=null);var t=e.samples[0],a=e.samples[e.samples.length-1];e.rate=l(t,a),e.remaining=Math.abs(e.target-a.value),e.estimate=new Date(a.time.getTime()+e.remaining/e.rate),r()}function r(){e.segments=[];var t=document.getElementsByClassName("graph")[0];e.chart={width:t.offsetWidth,height:1.5*t.offsetWidth};var a,n,i=20,r=e.chart.height-10,o=10,u=e.chart.width-10,m=s.bind(void 0,e.samples[0].time.getTime(),e.estimate.getTime(),i,r),p=s.bind(void 0,e.samples[0].value,e.target,o,u),g=e.samples.concat({time:e.estimate,value:e.target}).map(function(e){return angular.extend(e,{y:m(e.time),x:p(e.value)})});for(a=1,n=g.length;n>a;a++){var v=g[a-1],h=g[a];e.segments.push({points:[[u,v.y],[v.x,v.y],[h.x,h.y],[u,h.y]].join(" "),label:{text:l(v,h),x:u,y:h.y}})}e.ticks=[{x:o,y:i,label:"0%"},{x:o,y:(r+i)/2,label:"50%"},{x:o,y:r,label:"100%"}]}e.samples=[],e.target=0,e.rate=null,e.remaining=null,e.estimate=null;var o="down";if(o){var u=new Date,m=new Date;u.setMinutes(u.getMinutes()-30),m.setMinutes(m.getMinutes()-20),"up"==o?(e.samples=[{time:u,value:2},{time:m,value:434},{time:new Date,value:760}],e.target=1e3):"down"==o&&(e.samples=[{time:u,value:1e3},{time:m,value:540},{time:new Date,value:200}],e.target=0)}e.$watch("target",i),e.$watchCollection("samples",function(){e.samples=t("orderBy")(e.samples,'"time"'),i()}),e.add=function(){e.samples.push({time:e.newsample.time?n(e.newsample.time):new Date,value:parseFloat(e.newsample.value)}),e.newsample={time:null,value:null}},e.remove=function(t){var a=e.samples.indexOf(t);e.samples.splice(a,1)}}]),angular.module("howLongFilters",[]).filter("rate",function(){var e={sec:1e3,min:6e4,hour:36e5,day:864e5};return function(t,a,n){{var l=parseFloat(t);parseInt(t,10)}if(isNaN(l))return"";if(n=isNaN(parseInt(n,10))?3:n,a=a||"min",!e[a])return"";var s=t*e[a];return s%1!==0&&(s=parseFloat(s.toFixed(n)).toString()),s+" / "+a}});